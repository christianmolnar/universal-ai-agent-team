# Vercel Deployment Guide
**Created**: December 29, 2024  
**Status**: Ready to Deploy

---

## Quick Deploy to Vercel

### Option 1: Deploy via Vercel Dashboard (Recommended)

1. **Go to Vercel Dashboard**: https://vercel.com/new

2. **Import Git Repository**
   - Click "Add New Project"
   - Select "Import Git Repository"
   - Choose: `christianmolnar/universal-ai-agent-team`
   - Click "Import"

3. **Configure Project**
   ```
   Framework Preset: Next.js
   Root Directory: ./
   Build Command: npm run build
   Output Directory: .next
   Install Command: npm install
   ```

4. **Add Environment Variables** (CRITICAL)
   Click "Environment Variables" and add:
   
   ```env
   # Railway Database (Required)
   PGHOST=your-railway-host.railway.app
   PGDATABASE=railway
   PGUSER=postgres
   PGPASSWORD=your-railway-password
   PGPORT=5432
   
   # Next.js (Optional)
   NEXT_PUBLIC_APP_URL=https://your-app.vercel.app
   ```
   
   **‚ö†Ô∏è Get Railway credentials from your `.env` file**

5. **Deploy**
   - Click "Deploy"
   - Wait 2-3 minutes for build to complete
   - Vercel will provide a live URL

---

### Option 2: Deploy via Vercel CLI

1. **Install Vercel CLI**
   ```bash
   npm install -g vercel
   ```

2. **Login to Vercel**
   ```bash
   vercel login
   ```

3. **Deploy from Project Root**
   ```bash
   cd /Users/christian/Repos/universal-ai-agent-team
   vercel
   ```

4. **Follow Prompts**
   - Set up and deploy? `Y`
   - Which scope? (Select your account)
   - Link to existing project? `N`
   - What's your project's name? `universal-ai-agent-team`
   - In which directory is your code located? `./`
   - Want to override settings? `N`

5. **Add Environment Variables**
   ```bash
   vercel env add PGHOST
   vercel env add PGDATABASE
   vercel env add PGUSER
   vercel env add PGPASSWORD
   vercel env add PGPORT
   ```
   
   Enter values when prompted (copy from `.env` file)

6. **Deploy to Production**
   ```bash
   vercel --prod
   ```

---

## Post-Deployment Checklist

### ‚úÖ Verify Deployment

1. **Visit Your Vercel URL**
   - Example: `https://universal-ai-agent-team.vercel.app`
   - Check that homepage loads

2. **Test Database Connection**
   - Visit: `https://your-app.vercel.app/api/db-init`
   - Should return: `{"message":"Database initialized successfully",...}`

3. **Test Property Scraping**
   - Go to `/portfolio` page
   - Try adding a property via Zillow URL
   - Verify it saves to database

4. **Check Dashboard**
   - Go to homepage `/`
   - Verify real properties display (Ravensdale, Maple Valley)
   - Check that calculations are correct

### ‚ö†Ô∏è Common Issues

**Issue**: "Database connection failed"
- **Fix**: Verify environment variables in Vercel dashboard
- Go to: Project Settings ‚Üí Environment Variables
- Ensure all PGHOST, PGDATABASE, PGUSER, PGPASSWORD, PGPORT are set

**Issue**: "Build failed - TypeScript errors"
- **Fix**: Check build logs in Vercel dashboard
- Run `npm run build` locally to test
- Fix any TypeScript errors and push

**Issue**: "500 Internal Server Error"
- **Fix**: Check Vercel Function Logs
- Go to: Deployments ‚Üí [Your Deployment] ‚Üí Functions
- Look for error messages

**Issue**: "Images not loading"
- **Fix**: Check base64 image sizes
- Vercel has 4.5MB response limit
- Large images may need CDN storage

---

## Environment Variables Reference

### Required Variables
```env
PGHOST=autorack.proxy.rlwy.net
PGDATABASE=railway
PGUSER=postgres
PGPASSWORD=******************
PGPORT=5432
```

### Optional Variables (for V2)
```env
# AI APIs (Coming in Phase 5)
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-...

# Google Maps (Coming in Phase 8)
GOOGLE_MAPS_API_KEY=AIza...

# Yelp (Coming in Phase 8)
YELP_API_KEY=...

# Next.js
NEXT_PUBLIC_APP_URL=https://your-app.vercel.app
NODE_ENV=production
```

---

## Vercel Configuration

### vercel.json (Optional Custom Config)
```json
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "regions": ["iad1"],
  "env": {
    "PGHOST": "@pghost",
    "PGDATABASE": "@pgdatabase",
    "PGUSER": "@pguser",
    "PGPASSWORD": "@pgpassword",
    "PGPORT": "@pgport"
  },
  "functions": {
    "app/api/**/*.ts": {
      "maxDuration": 30
    }
  }
}
```

**Note**: This file is optional. Vercel auto-detects Next.js projects.

---

## Custom Domain Setup (Optional)

1. **Go to Project Settings** in Vercel Dashboard
2. **Click "Domains"**
3. **Add Domain**: `yourdomain.com`
4. **Update DNS Records** (at your domain registrar)
   - Add CNAME record: `yourdomain.com` ‚Üí `cname.vercel-dns.com`
   - Or A record to Vercel's IP
5. **Wait for DNS Propagation** (5-10 minutes)
6. **SSL Certificate**: Auto-generated by Vercel

---

## Continuous Deployment

### Automatic Deployments
Vercel automatically deploys when you push to GitHub:

- **Production**: Push to `main` branch ‚Üí Production deployment
- **Preview**: Push to other branches ‚Üí Preview deployment
- **Pull Requests**: Automatic preview deployments

### Deploy Hooks (Optional)
Create webhook for manual deployments:
1. Project Settings ‚Üí Git ‚Üí Deploy Hooks
2. Create Hook (e.g., "Manual Deploy")
3. Copy webhook URL
4. Trigger: `curl -X POST https://api.vercel.com/v1/integrations/deploy/...`

---

## Monitoring & Analytics

### Vercel Analytics
1. Go to Project Settings ‚Üí Analytics
2. Enable Web Analytics
3. View real-time traffic, Core Web Vitals

### Error Tracking
1. Go to Project ‚Üí Deployments ‚Üí [Latest] ‚Üí Functions
2. View server-side errors and logs
3. Filter by API route, time range

### Performance Monitoring
- Check build times in Deployments tab
- Monitor function execution times
- Review bandwidth usage

---

## Cost Estimate

### Vercel Pricing (as of Dec 2024)

**Hobby Plan (Free)**
- 100 GB bandwidth/month
- Unlimited deployments
- 100 GB-hours serverless function execution
- Perfect for development and testing

**Pro Plan ($20/month)**
- 1 TB bandwidth
- Password protection
- Advanced analytics
- Team collaboration
- Recommended for production

**Railway Database Costs**
- Starter Plan: $5/month (512MB RAM, 1GB storage)
- Developer Plan: $10/month (8GB RAM, 10GB storage)
- Current usage: Minimal (well within Starter plan)

**Total Estimated Cost**: $0-25/month depending on usage

---

## Rollback & Version Control

### Rollback to Previous Deployment
1. Go to Deployments tab
2. Find previous working deployment
3. Click "..." ‚Üí "Promote to Production"
4. Instant rollback (no rebuild needed)

### Environment Variable Changes
- Changes require redeployment
- Click "Redeploy" button after updating variables

---

## Security Best Practices

### Environment Variables
- ‚úÖ Never commit `.env` to git (already in `.gitignore`)
- ‚úÖ Use Vercel's encrypted environment variable storage
- ‚úÖ Rotate Railway database password periodically

### API Routes
- ‚úÖ Validate user input in all API routes
- ‚úÖ Use parameterized SQL queries (prevents SQL injection)
- ‚úÖ Rate limit expensive operations
- ‚è≥ Add authentication (coming in V2)

### Database
- ‚úÖ Railway uses SSL for connections
- ‚úÖ Database credentials encrypted by Vercel
- ‚úÖ Regular automated backups (Railway)

---

## Troubleshooting

### Build Logs
View detailed build output:
1. Deployments ‚Üí [Latest Deployment]
2. Click "Building" or "Build Logs"
3. Expand sections to see full output

### Function Logs
View runtime errors:
1. Deployments ‚Üí [Latest Deployment] ‚Üí Functions
2. Select API route (e.g., `/api/properties`)
3. View invocation logs and errors

### Database Connection Test
Run this in Vercel Function:
```typescript
// app/api/test-db/route.ts
import { NextResponse } from 'next/server';
import { DatabaseManager } from '@/lib/database';

export async function GET() {
  try {
    const pool = DatabaseManager.getPool();
    const result = await pool.query('SELECT NOW()');
    return NextResponse.json({ 
      success: true, 
      time: result.rows[0].now,
      config: {
        host: process.env.PGHOST,
        database: process.env.PGDATABASE,
        port: process.env.PGPORT
      }
    });
  } catch (error) {
    return NextResponse.json({ 
      success: false, 
      error: error.message 
    }, { status: 500 });
  }
}
```

---

## Next Steps After Deployment

1. **‚úÖ Verify Production Deployment**
   - Test all pages and API routes
   - Verify database connectivity
   - Test property scraping and saving

2. **üìä Set Up Monitoring**
   - Enable Vercel Analytics
   - Configure error notifications
   - Set up uptime monitoring (optional: UptimeRobot)

3. **üöÄ Begin Real Estate Analysis V2**
   - Phase 1: Database schema for analysis system
   - Phase 2: New landing page and property type selection
   - Continue through 10-phase implementation plan

4. **üì± Share Preview**
   - Share Vercel URL with stakeholders
   - Gather feedback on current functionality
   - Prepare for V2 feature rollout

---

## Support Resources

- **Vercel Docs**: https://vercel.com/docs
- **Next.js Deployment**: https://nextjs.org/docs/deployment
- **Railway Docs**: https://docs.railway.app
- **Vercel Community**: https://github.com/vercel/vercel/discussions

---

## Document History

| Date | Action | Notes |
|------|--------|-------|
| 2024-12-29 | Created | Initial deployment guide |

